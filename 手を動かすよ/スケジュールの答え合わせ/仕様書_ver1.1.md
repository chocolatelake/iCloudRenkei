# ã‚¢ãƒ—ãƒªã‚±ãƒ¼ã‚·ãƒ§ãƒ³è©³ç´°ä»•æ§˜æ›¸

**ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå:** èº«æ”¯åº¦ã®æ™‚é–“ã‚’æŠŠæ¡ã™ã‚‹ã‚¢ãƒ—ãƒª  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³:** 4.0 (Final Fix)  
**ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ :** iOS (Swift Playgrounds / SwiftUI)  
**ãƒ‡ãƒ¼ã‚¿ä¿å­˜:** ãƒ­ãƒ¼ã‚«ãƒ« (UserDefaults) - å®Œå…¨ã‚ªãƒ•ãƒ©ã‚¤ãƒ³å‹•ä½œ

---

## 1. ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ¦‚è¦

### 1-1. ã‚³ã‚¢ãƒ»ã‚³ãƒ³ã‚»ãƒ—ãƒˆ
ã€Œé›»è»Šã®ç™ºè»Šæ™‚åˆ»ï¼ˆãƒ‡ãƒƒãƒ‰ãƒ©ã‚¤ãƒ³ï¼‰ã€ã¯å¤‰ãˆã‚‰ã‚Œãªã„ãŒã€ã€Œé§…ã«åˆ°ç€ã™ã‚‹æ™‚åˆ»ã€ã¯è‡ªåˆ†ã®åŠªåŠ›ã§ã‚³ãƒ³ãƒˆãƒ­ãƒ¼ãƒ«ã§ãã‚‹ã€‚
æœ¬ã‚¢ãƒ—ãƒªã¯ã€æ—¥ã€…ã®ã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ãƒ¡ãƒ¢ã‹ã‚‰ãƒ‡ãƒƒãƒ‰ãƒ©ã‚¤ãƒ³ã‚’è‡ªå‹•æŠ½å‡ºã—ã€é§…åˆ°ç€æ™‚ã«**ã€Œèº«æ”¯åº¦ãŒè¨ˆç”»é€šã‚Šã«é€²ã‚“ã ã‹ï¼ˆWinï¼‰ã€**ã‚ã‚‹ã„ã¯**ã€Œè¦‹ç©ã‚‚ã‚ŠãŒç”˜ã‹ã£ãŸã‹ï¼ˆLoseï¼‰ã€**ã‚’åˆ¤å®šã™ã‚‹ã€äºˆå®Ÿç®¡ç†ãƒ„ãƒ¼ãƒ«ã§ã‚ã‚‹ã€‚

### 1-2. ã‚·ã‚¹ãƒ†ãƒ æ§‹æˆ
æœ¬ã‚·ã‚¹ãƒ†ãƒ ã¯ã€Œã‚¢ãƒ—ãƒªã€ã¨ã€ŒOSæ©Ÿèƒ½ã€ã®2ã¤ã§æ§‹æˆã•ã‚Œã‚‹ã€‚

1.  **ã‚¢ãƒ—ãƒªæœ¬ä½“:** ãƒ†ã‚­ã‚¹ãƒˆè§£æã€ç›®æ¨™è¨­å®šã€æ­£èª¤åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã‚’æ‹…ã†ã€‚
2.  **iOSã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆ:** ä½ç½®æƒ…å ±ï¼ˆã‚¸ã‚ªãƒ•ã‚§ãƒ³ã‚¹ï¼‰ã‚’ãƒˆãƒªã‚¬ãƒ¼ã¨ã—ã€é§…åˆ°ç€æ™‚ã«ã‚¢ãƒ—ãƒªã‚’èµ·å‹•ã™ã‚‹å½¹å‰²ã‚’æ‹…ã†ã€‚

---

## 2. ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã¨å…·ä½“ä¾‹ (Simulation)

ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®å…¥åŠ›å†…å®¹ã¨è¡Œå‹•ã«ã‚ˆã£ã¦ã€ã‚¢ãƒ—ãƒªãŒã©ã†åå¿œã™ã‚‹ã‹ã‚’å®šç¾©ã™ã‚‹ã€‚

### äº‹å‰è¨­å®šå€¤
* **æœ€å¯„ã‚Šé§…å:** `ç¯ å´`
* **ä½™è£•ãƒãƒƒãƒ•ã‚¡:** `5åˆ†`

### ã€Case 1: æ­£å¸¸ç³»ãƒ»ä½™è£•ã®å‹åˆ©ã€‘
**å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ:**
> 6:30 èµ·ãã‚‹
> 7:35 å®¶å‡ºã‚‹
> 7:56 ç¯ å´ç™º
> 8:23 å°å·ç”ºç€

**ã‚¢ãƒ—ãƒªã®è§£æ:**
1.  ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ `ç¯ å´` ã‚’å«ã‚€è¡Œã‚’æ¤œç´¢ â†’ `7:56 ç¯ å´ç™º` ãŒãƒ’ãƒƒãƒˆã€‚
2.  æ™‚åˆ»ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’æŠ½å‡º â†’ ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ™‚åˆ» **`07:56`** ã‚’ç¢ºå®šã€‚

**ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:**
* ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ **07:49** ã«é§…ã«åˆ°ç€ï¼ˆã‚ªãƒ¼ãƒˆãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§ã‚¢ãƒ—ãƒªèµ·å‹•ï¼‰ã€‚
* åˆ¤å®šãƒœã‚¿ãƒ³ã‚’æŠ¼ä¸‹ã€‚

**åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯:**
* æ®‹ã‚Šæ™‚é–“ = 07:56 - 07:49 = **7åˆ†**
* åŸºæº–ï¼ˆ5åˆ†ï¼‰ä»¥ä¸Šã‚ã‚‹ãŸã‚ â†’ **ğŸ† Win (æˆåŠŸ)**

---

### ã€Case 2: æ­£å¸¸ç³»ãƒ»ã‚®ãƒªã‚®ãƒªã‚»ãƒ¼ãƒ•ã€‘
**å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ:**
> (Case 1ã¨åŒã˜)
> ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ: **07:56**

**ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:**
* ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ **07:53** ã«é§…ã«åˆ°ç€ã€‚

**åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯:**
* æ®‹ã‚Šæ™‚é–“ = 07:56 - 07:53 = **3åˆ†**
* åŸºæº–ï¼ˆ5åˆ†ï¼‰æœªæº€ã ãŒã€0åˆ†ä»¥ä¸Š â†’ **âš ï¸ Safe (ã‚®ãƒªã‚®ãƒª)**
* *ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:ã€Œé–“ã«åˆã„ã¾ã™ãŒæ€¥ã„ã§ï¼ãƒ›ãƒ¼ãƒ ã¾ã§ãƒ€ãƒƒã‚·ãƒ¥ï¼ã€*

---

### ã€Case 3: ç•°å¸¸ç³»ãƒ»é…åˆ» (Lose)ã€‘
**å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ:**
> (Case 1ã¨åŒã˜)
> ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ: **07:56**

**ã‚¢ã‚¯ã‚·ãƒ§ãƒ³:**
* ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒ **07:57** ã«é§…ã«åˆ°ç€ã€‚

**åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯:**
* æ®‹ã‚Šæ™‚é–“ = 07:56 - 07:57 = **-1åˆ†**
* 0åˆ†æœªæº€ â†’ **ğŸ’€ Lose (å¤±æ•—)**
* *ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸:ã€Œå‡ºç™ºæ™‚åˆ»ã‚’éãã¦ã„ã¾ã™ã€‚æ¬¡ã®é›»è»Šã‚’æ¤œç´¢ã—ã¾ã—ã‚‡ã†ã€‚ã€*

---

### ã€Case 4: å…¥åŠ›ã‚¨ãƒ©ãƒ¼ãƒ»è¡¨è¨˜æºã‚Œã€‘
**å…¥åŠ›ãƒ†ã‚­ã‚¹ãƒˆ:**
> 7:35 å®¶å‡ºã‚‹
> 7:56 é§…ã«ç€ã
> (â€»ã€Œç¯ å´ã€ã¨æ›¸ã„ã¦ã„ãªã„)

**ã‚¢ãƒ—ãƒªã®è§£æ:**
1.  ã‚­ãƒ¼ãƒ¯ãƒ¼ãƒ‰ `ç¯ å´` ã‚’å«ã‚€è¡Œã‚’æ¤œç´¢ â†’ **è©²å½“ãªã—**ã€‚

**çµæœ:**
* ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: **ã€Œç¯ å´ã®äºˆå®šãŒè¦‹ã¤ã‹ã‚Šã¾ã›ã‚“ã€**
* ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ: **æœªè¨­å®š (--:--)**
* *ãƒ¦ãƒ¼ã‚¶ãƒ¼ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: ãƒ†ã‚­ã‚¹ãƒˆã‚’ä¿®æ­£ã—ã¦ã€Œç¯ å´ã€ã‚’æ›¸ãåŠ ãˆã‚‹å¿…è¦ãŒã‚ã‚‹ã€‚*

---

## 3. æ©Ÿèƒ½è¦ä»¶ (Functional Requirements)

### 3-1. ãƒ†ã‚­ã‚¹ãƒˆè§£æã‚¨ãƒ³ã‚¸ãƒ³ (Parser)
å…¥åŠ›ã•ã‚ŒãŸãƒ†ã‚­ã‚¹ãƒˆå…¨æ–‡ã«å¯¾ã—ã€ä»¥ä¸‹ã®æ‰‹é †ã§å‡¦ç†ã‚’è¡Œã†ã€‚

1.  **è¡Œåˆ†å‰²:** æ”¹è¡Œã‚³ãƒ¼ãƒ‰ (`\n`) ã§ãƒ†ã‚­ã‚¹ãƒˆã‚’é…åˆ—åŒ–ã™ã‚‹ã€‚
2.  **ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°:** ãƒ¦ãƒ¼ã‚¶ãƒ¼è¨­å®šã® `stationName` (String) ã‚’å«ã‚€è¡Œã‚’æŠ½å‡ºã™ã‚‹ã€‚
3.  **æ™‚åˆ»æŠ½å‡º (Regex):**
    * æ­£è¦è¡¨ç¾ãƒ‘ã‚¿ãƒ¼ãƒ³: `([0-9]{1,2}):([0-9]{2})`
    * å¯¾è±¡è¡Œã‹ã‚‰æœ€åˆã«ãƒãƒƒãƒã—ãŸã‚‚ã®ã‚’æ¡ç”¨ã™ã‚‹ã€‚
    * ä¾‹: `7:56` -> Hour: `7`, Minute: `56`
4.  **Dateã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆç”Ÿæˆ:**
    * ã€Œä»Šæ—¥ã®å¹´æœˆæ—¥ã€+ã€ŒæŠ½å‡ºã—ãŸæ™‚åˆ†ã€ã‚’åˆæˆã—ã€`TargetDate` ã‚’ç”Ÿæˆã™ã‚‹ã€‚
    * *è£œè¶³: æ·±å¤œ25æ™‚è¡¨è¨˜ãªã©ã®å¯¾å¿œã¯ä»Šå›ã¯è¡Œã‚ãšã€æ¨™æº–çš„ãªæ™‚åˆ»è¡¨è¨˜(0:00-23:59)ã¨ã™ã‚‹ã€‚*

### 3-2. åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ (Judge)
ã€Œåˆ¤å®šå®Ÿè¡Œã€ãƒˆãƒªã‚¬ãƒ¼ãŒç™ºç”Ÿã—ãŸç¬é–“ã® `CurrentTime` ã¨ `TargetDate` ã‚’æ¯”è¼ƒã™ã‚‹ã€‚

* **Diff (åˆ†)** = (`TargetDate` - `CurrentTime`) / 60ç§’
* **æ¡ä»¶åˆ†å²:**
    | åˆ¤å®šåŒºåˆ† | æ¡ä»¶å¼ | UIã‚«ãƒ©ãƒ¼ |
    | :--- | :--- | :--- |
    | **Win (æˆåŠŸ)** | `Diff` >= `bufferMinutes` | ğŸŸ¢ Green |
    | **Safe (è€ãˆ)** | 0 <= `Diff` < `bufferMinutes` | ğŸŸ  Orange |
    | **Lose (å¤±æ•—)** | `Diff` < 0 | ğŸ”´ Red |

---

## 4. UI/UX ä»•æ§˜

### 4-1. ãƒ¡ã‚¤ãƒ³ç”»é¢ (Dashboard)
ã‚¢ãƒ—ãƒªèµ·å‹•ç›´å¾Œã«è¡¨ç¤ºã•ã‚Œã‚‹ç”»é¢ã€‚

* **Header Area:**
    * ã‚¢ãƒ—ãƒªã‚¿ã‚¤ãƒˆãƒ«è¡¨ç¤ºã€‚
    * è¨­å®šãƒœã‚¿ãƒ³ï¼ˆå³ä¸Šã®ã‚®ã‚¢ã‚¢ã‚¤ã‚³ãƒ³ï¼‰ã€‚
* **Target Info Area (Center):**
    * **ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ™‚åˆ»:** ç‰¹å¤§ãƒ•ã‚©ãƒ³ãƒˆã§è¡¨ç¤ºï¼ˆä¾‹: `07:56`ï¼‰ã€‚
    * **é§…å:** ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæ™‚åˆ»ã®ä¸‹ã«è¡¨ç¤ºï¼ˆä¾‹: `ç¯ å´ ç™º`ï¼‰ã€‚
    * **ã‚«ã‚¦ãƒ³ãƒˆãƒ€ã‚¦ãƒ³:** ç¾åœ¨æ™‚åˆ»ã¨ã®å·®åˆ†ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ è¡¨ç¤ºï¼ˆä¾‹: `ã‚ã¨ 05:30`ï¼‰ã€‚
    * *â€»ã‚¿ãƒ¼ã‚²ãƒƒãƒˆæœªæ¤œå‡ºæ™‚ã¯ã€Œäºˆå®šãªã—ã€ç­‰ã®ãƒ—ãƒ¬ãƒ¼ã‚¹ãƒ›ãƒ«ãƒ€ãƒ¼ã‚’è¡¨ç¤ºã€‚*
* **Message Area:**
    * åˆ¤å®šçµæœã€ã¾ãŸã¯ã‚¬ã‚¤ãƒ‰ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹é ˜åŸŸã€‚
    * èƒŒæ™¯è‰²ã‚’ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚«ãƒ©ãƒ¼ï¼ˆç·‘ãƒ»æ©™ãƒ»èµ¤ï¼‰ã«å¤‰æ›´ã—ã€è¦–èªæ€§ã‚’é«˜ã‚ã‚‹ã€‚
* **Action Button (Bottom):**
    * **ã€Œé§…ã«åˆ°ç€ (åˆ¤å®š)ã€ãƒœã‚¿ãƒ³:**
        * ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒèƒ½å‹•çš„ã«æŠ¼ã™ã“ã¨ã§åˆ¤å®šãƒ­ã‚¸ãƒƒã‚¯ã‚’èµ°ã‚‰ã›ã‚‹ã€‚
        * ã‚ªãƒ¼ãƒˆãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã§èµ·å‹•ã—ãŸéš›ã‚‚ã€èª¤å‹•ä½œé˜²æ­¢ã®ãŸã‚ã€Œèµ·å‹•â†’ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒãƒœã‚¿ãƒ³ã‚¿ãƒƒãƒ—ã€ã®ãƒ•ãƒ­ãƒ¼ã‚’åŸºæœ¬ã¨ã™ã‚‹ã€‚
    * **ã€Œã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ç·¨é›†ã€ãƒœã‚¿ãƒ³:**
        * ãƒ†ã‚­ã‚¹ãƒˆå…¥åŠ›ã‚·ãƒ¼ãƒˆã‚’é–‹ãã€‚

### 4-2. å…¥åŠ›ç”»é¢ (Input Sheet)
* **ãƒ†ã‚­ã‚¹ãƒˆã‚¨ãƒ‡ã‚£ã‚¿:**
    * è¤‡æ•°è¡Œå…¥åŠ›å¯èƒ½ãª `TextEditor`ã€‚
    * ãƒšãƒ¼ã‚¹ãƒˆæ“ä½œãŒã—ã‚„ã™ã„åºƒã•ã‚’ç¢ºä¿ã€‚
* **ä¿å­˜ãƒœã‚¿ãƒ³:**
    * ã‚¿ãƒƒãƒ—æ™‚ã«è§£æã‚¨ãƒ³ã‚¸ãƒ³ã‚’èµ°ã‚‰ã›ã€ç”»é¢ã‚’é–‰ã˜ã‚‹ã€‚

### 4-3. è¨­å®šç”»é¢ (Settings)
* **æœ€å¯„ã‚Šé§…è¨­å®š:** ãƒ†ã‚­ã‚¹ãƒˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: "ç¯ å´"ï¼‰ã€‚
* **ãƒãƒƒãƒ•ã‚¡è¨­å®š:** ã‚¹ãƒ†ãƒƒãƒ‘ãƒ¼ï¼ˆç¯„å›²: 0ã€œ30åˆ† / ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ: 5åˆ†ï¼‰ã€‚
* *èª¬æ˜æ–‡:ã€Œã“ã“ã§è¨­å®šã—ãŸé§…åã‚’å«ã‚€è¡Œã‹ã‚‰ã€æ™‚é–“ã‚’è‡ªå‹•å–å¾—ã—ã¾ã™ã€ã¨æ˜è¨˜ã€‚*

---

## 5. ãƒ‡ãƒ¼ã‚¿æ°¸ç¶šåŒ– (Persistence)

`UserDefaults` ã‚’ä½¿ç”¨ã—ã€ã‚¢ãƒ—ãƒªã‚’çµ‚äº†ã—ã¦ã‚‚ä»¥ä¸‹ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã™ã‚‹ã€‚

| Key | å‹ | ç”¨é€” |
| :--- | :--- | :--- |
| `stationName` | String | æ¤œç´¢å¯¾è±¡ã®é§…åï¼ˆè¨­å®šå€¤ï¼‰ |
| `bufferMinutes` | Int | æˆåŠŸåˆ¤å®šã®ã—ãã„å€¤ï¼ˆè¨­å®šå€¤ï¼‰ |
| `savedText` | String | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒå‰å›å…¥åŠ›ã—ãŸã‚¹ã‚±ã‚¸ãƒ¥ãƒ¼ãƒ«ã®å…¨æ–‡ |

---

## 6. iOSé€£æºä»•æ§˜ (External Trigger)

ã‚¢ãƒ—ãƒªå˜ä½“ã§ã¯ä½ç½®æƒ…å ±ã‚’å–å¾—ã—ãªã„ãŸã‚ã€iOSæ¨™æº–æ©Ÿèƒ½ã«ä¾å­˜ã™ã‚‹ã€‚

1.  **ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆã‚¢ãƒ—ãƒªè¨­å®š:**
    * ãƒ¦ãƒ¼ã‚¶ãƒ¼è‡ªèº«ãŒã€Œã‚ªãƒ¼ãƒˆãƒ¡ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚’ä½œæˆã™ã‚‹ã€‚
    * ãƒˆãƒªã‚¬ãƒ¼: **ã€Œ[æœ€å¯„ã‚Šé§…] ã®ç¯„å›²ã«å…¥ã£ãŸã¨ãã€**
    * ã‚¢ã‚¯ã‚·ãƒ§ãƒ³: **ã€Œ[èº«æ”¯åº¦ã‚¢ãƒ—ãƒª] ã‚’é–‹ãã€**
2.  **æŒ™å‹•:**
    * ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒé§…ã«è¿‘ã¥ã â†’ iOSãŒæ¤œçŸ¥ â†’ é€šçŸ¥ã‚¿ãƒƒãƒ— or è‡ªå‹•ã§ã‚¢ãƒ—ãƒªãŒå‰é¢ã«èµ·å‹• â†’ ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã€Œåˆ°ç€ãƒœã‚¿ãƒ³ã€ã‚’æŠ¼ã™ â†’ **åˆ¤å®šå®Œäº†**ã€‚

